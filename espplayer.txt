-- LocalScript

-- Fonksiyon, bir oyuncunun karakter modelini alır ve onun köşesine bir BillboardGui ekler
local function createPlayerIndicator(player)
    local playerIndicator = Instance.new("BillboardGui")
    playerIndicator.Name = "PlayerIndicator"
    playerIndicator.AlwaysOnTop = true
    playerIndicator.Size = UDim2.new(0, 100, 0, 20)
    playerIndicator.StudsOffset = Vector3.new(0, 3, 0)  -- Konumu ayarlamak için kullanılabilir

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, 0, 1, 0)
    frame.BackgroundTransparency = 1
    frame.BorderSizePixel = 0

    local line = Instance.new("Frame")
    line.Size = UDim2.new(1, 0, 0, 2)  -- Çizgi boyutunu ayarlamak için kullanılabilir
    line.Position = UDim2.new(0, 0, 0.5, 0)
    line.BackgroundColor3 = Color3.new(1, 1, 0)  -- Çizgi rengini ayarlamak için kullanılabilir

    line.Parent = frame
    frame.Parent = playerIndicator
    playerIndicator.Parent = player.Character:WaitForChild("Head")

    -- BillboardGui'nin güncellenmesi
    local function updateIndicator()
        if player and player.Character and player.Character:FindFirstChild("Head") then
            local headPosition = player.Character.Head.Position
            local screenPosition, onScreen = workspace.CurrentCamera:WorldToScreenPoint(headPosition)
            
            if onScreen then
                playerIndicator.Adornee = nil
                playerIndicator.Enabled = true
                playerIndicator.Position = UDim2.new(0, screenPosition.X, 0, screenPosition.Y)
            else
                playerIndicator.Adornee = player.Character.Head
                playerIndicator.Enabled = false
            end
        else
            playerIndicator:Destroy()
        end
    end

    -- Güncelleme işlevini başlatma
    updateIndicator()
    player.CharacterAdded:Connect(updateIndicator)
    player.CharacterRemoving:Connect(function()
        playerIndicator:Destroy()
    end)
end

-- Tüm oyuncular için PlayerAdded olayına bağlanma
game.Players.PlayerAdded:Connect(function(player)
    createPlayerIndicator(player)
end)
